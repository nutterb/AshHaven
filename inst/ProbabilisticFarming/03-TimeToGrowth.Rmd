# Time to Growth

The Time To Growth ($TTG$) is the duration of time until a crop advances a growth stage measured in minutes. The probability of growth is the intersection of the independent events of a random tick being assigned to the block and growth occurring. For a single block, the probability of a growth event is 

$$
\Pr(RTick \cap Growth) = \Pr(RTick) \cdot \Pr(Growth | RTick)
$$

As farms increase in size, however, the probability of a growth event changes. It must also be considered that a farm with more than one block assigned may have more than one growth event within a single tick. This means the probability function must account for both the number of blocks assigned a random tick and the number of ticked blocks that experience growth. 

It was demonstrated earlier that the number of blocks in the farm receiving a random tick has a hypergeometric probability distribution. Suppose, then, that $F_r$ blocks of farm land receive a random tick. Each has an independent probability of advancing a growth stage $\Pr(Growth|RTick)$, and the number of those blocks that advance a stage can be modeled using a _Binomial_ distribution with $n = F_r$ and $p = \Pr(Growth|RTick)$.

The calculation is further complicated by the fact that both the number of the number of farm blocks receiving a random tick and the number of growth events among those blocks are both random variables. There may be between zero and three farm blocks that receive a random tick, and between zero and three blocks that experience growth, creating sixteen events in the joint sample space. Applying the Law of Total Probability, the probability distribution function for $G$ growth events for $F_r$ farm blocks receiving a random tick is (using $rts$ as the random tick speed and $B$ as the number of blocks in a subchunk):

$$\begin{aligned}
\Pr(G = g, F_r = f | F)
  &= \frac{HyperG(F, f, B, rts) \cdot Binom(g; n = f, p = \Pr(Growth|RTick))}
          {\sum\limits_{i_f}^{F_r} \sum\limits_{i_g}^g 
            HyperG(F, i_f, B, rts) \cdot 
            Binom(i_g; n = i_f, p = \Pr(Growth|RTick))} \\
  &= \frac{\frac{{F \choose f}{B-F \choose rts - f}}{{B \choose rts}} \cdot 
                 {f \choose g} \cdot \Pr(Growth|RTick) ^ g \cdot (1 - \Pr(Growth|RTick)) ^ {f-g}}
          {\sum\limits_{i_f}^{F_r} \sum\limits_{i_g}^g 
              \frac{{F \choose i_f}{B-F \choose rts - i_f}}{{B \choose rts}} \cdot 
              {i_f \choose i_g} \cdot \Pr(Growth|RTick) ^ {i_g} \cdot (1 - \Pr(Growth|RTick)) ^ {i_f-i_g}}
\end{aligned}$$

Understanding the probability distribution of growth is essential to calculating $TTG$. Similar to the Time to Random Tick ($TTR$), the mean and median $TTG$ can be modeled with a geometric distribution, so long as we can provide the value of $p$, the probability of growth. Using the formula above, we can calculate $p$ as 

$$\begin{aligned}
p &= \Pr(G > 0, 0 < F_r < rts | F) \\
  &= \sum\limits_{g = 1}^0 
     \sum\limits_{f_r = 0}^{rts} \Pr(G = g, F_r = f_r | F)
\end{aligned}$$

```{r}
SampleSpace <- 
  expand.grid(G = 0:3, 
              Fr = 0:3) %>% 
  mutate(prob = mapply(p_growth_phase, 
                       g = G, 
                       fr = Fr, 
                       MoreArgs = list(f = 50, 
                                       p_growth = 0.15),
                       SIMPLIFY = FALSE)) 
```

In conceptual terms, $p$ is the sum of probabilities from the joint sample space of $G$ and $F_r$ where $G > 0$. To illustrate, consider a bamboo farm consisting of 50 blocks and that for bamboo $\Pr(Growth | RTick) = 0.15$. The probability distribution of the joint sample space is shown in the next table, and $p$ is the sum of the three columns on the right, or $p = `r SampleSpace %>% filter(G > 0) %>% select(prob) %>% unlist() %>% sum()`$.

```{r}
SampleSpace %>% 
  mutate(G = sprintf("G = %s", G)) %>% 
  dcast(Fr ~ G, 
        value.var = "prob") %>% 
  knitr::kable()
```

## Mean Time to Growth 

